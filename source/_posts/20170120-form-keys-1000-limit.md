---
title: è¸©å‘parameterLimit - ç¥ç§˜çš„1000parseé™åˆ¶
toc: true
date: 2017-01-20 22:31:52
tags:
categories:
thumbnail: //img003.qufenqi.com/products/6b/16/6b16f016aa06578523cec21b21c1f8bd.jpg
photo:
---


é¡¹ç›®ä¸­é‡åˆ°ä¸€ä¸ªè¯¡å¼‚çš„é—®é¢˜ï¼šæäº¤è¡¨å•æ—¶ï¼Œå­˜åœ¨å­—æ®µçš„å€¼å¦‚[1,2,3,4,...,M,N]ï¼Œä½†æ˜¯åœ¨æœåŠ¡ç«¯è§£æåˆ°çš„å€¼å´æ˜¯[1,2,3,...,M]ï¼Œæ•°æ®æ²¡æœ‰æŸåï¼Œååæ˜¯æœ€åå‡ ä¸ªå­—æ®µçš„æ•°æ®ç¥ç§˜æ¶ˆå¤±æ‰ï¼Œç–¯æ‰...

<!-- more -->

ä»”ç»†æ’æŸ¥äº†ä»è¯·æ±‚å‘é€åˆ°æ¥æ”¶å®Œæˆä¹‹é—´çš„ä¸šåŠ¡ä»£ç ï¼Œå¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆçš„è¯¡å¼‚çš„åœ°æ–¹ï¼Œåªæ–™æƒ³åº”è¯¥æ˜¯å­˜åœ¨æŸç§é™åˆ¶ï¼Œå¯¹æäº¤çš„è¡¨å•æ•°æ®çš„å±æ€§ï¼ˆlength? size? key?ï¼‰å­˜åœ¨æœ€å¤§é™åˆ¶ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ¥äº†...


## æŸ¥æ‰¾é™åˆ¶

æ—¢ç„¶æ˜¯é™åˆ¶ï¼Œé‚£å°±æœ‰å¯èƒ½æ˜¯æäº¤æ—¶æˆ–è€…æ¥æ”¶æ—¶åšäº†é™åˆ¶ï¼Œæ€»ä¹‹æ•°æ®ä¸å¯èƒ½åœ¨ä¼ è¾“æ—¶è«åå…¶å¦™è’¸å‘æ‰...

- é¦–ç°ï¼Œç¡®è®¤å‘é€äº†å®Œæ•´çš„æ•°æ®ï¼š
    - æ§åˆ¶å°ï¼ˆDevToolsï¼‰
    - æŠ“åŒ…ï¼ˆCharlesï¼‰

è¿™ä¸¤æ­¥éƒ½å¾ˆç®€å•ï¼Œç¨å¾®çœ‹ä¸€ä¸‹å°±å¯ä»¥ç¡®å®šæ•°æ®éƒ½æ˜¯å…¨çš„ï¼Œé‚£ä¹ˆé—®é¢˜å¾ˆå¯èƒ½å°±å‡ºåœ¨æœåŠ¡ç«¯äº†ï¼ˆåæ­£ä¸å¯èƒ½ä¼ è¾“å±‚ç¨³å®šæ¼ä¼ äº†å‡ ä¸ªå­—èŠ‚ï¼Œè¿˜åˆšåˆšå¥½å¯¹åº”å°‘çš„é‚£å‡ ä¸ªå­—æ®µï¼Œåæ­£æˆ‘æ˜¯ä¸ä¿¡ï¼‰

- ç„¶åï¼Œæ£€æŸ¥æœåŠ¡ç«¯æ”¶åˆ°æ•°æ®ï¼š
    - æ£€æŸ¥Responseä¸­è·å¾—çš„æ•°æ®ä½“ï¼ˆå…¶å®å°±æ˜¯è¿™æ­¥å‘ç°å°‘äº†æ•°æ®çš„ï¼‰
    - æ£€æŸ¥æœåŠ¡ç«¯æ”¶åˆ°çš„åŸå§‹ä¿¡æ¯ä¸­ï¼Œæ•°æ®æ˜¯å¦å®Œæ•´ï¼ˆåªå¥½å»æ’¸æºç äº†ï¼‰

è¯è¯´è¿™æ­¥æ’æŸ¥äº†æŒºä¹…ï¼ŒæŒ‰ä¾èµ–ä¾æ¬¡æ’æŸ¥ï¼Œæœ€ååœ¨[qs/lib/parse.js][url_qs/parser.js]å‘ç°äº†ä¸€ä¸ªåœ°æ–¹ğŸ‘‡

```js
internals.parseValues = function (str, options) {
    ...
    var parts = str.split(options.delimiter, options.parameterLimit === Infinity ? undefined : options.parameterLimit);
    ...
}
```

åœ¨qsä¸­ï¼Œæ‰¾åˆ°å¦‚ä¸‹å¯¹parameterLimitçš„å®šä¹‰ï¼š

> The depth limit helps mitigate abuse when qs is used to parse user input, and it is recommended to keep it a reasonably small number.
For similar reasons, by default qs will only **parse up to 1000 parameters**.  --- [ljharb/qs][url_qs]

ç¡®å®åœ¨ä¸Šè¿°æ–‡ä»¶é‡Œï¼Œæ‰¾åˆ°äº†è¿™æ ·çš„é»˜è®¤å€¼ï¼š

```js
// qs/lib/parse.js
// Declare internals
var internals = {
    ...
    delimiter: '&',
    parameterLimit: 1000,
    ...
};
```

å¥½äº†ï¼Œè¿™ä¸‹å¯çœŸç›¸å¤§ç™½äº†ï¼ŒåŸæ¥ä½¿ç”¨qsè§£æé”®å€¼å¯¹çš„æ—¶å€™ï¼Œç»™`split`ä¼ äº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯`str.split('&', 1000)`
è€Œ`split`çš„ç¬¬äºŒä¸ªå‚æ•°ï¼ŒæŸ¥çœ‹æ–‡æ¡£ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```js
stringObject.split(separator, howmany)
```

è¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥è§£é‡Šçš„é€šäº†ï¼Œé»˜è®¤åªsplitäº†1000ä¸ªé”®å€¼å¯¹ï¼Œè€Œåœ¨æäº¤çš„æ—¶å€™ï¼Œæ°å¥½è¶…å‡ºäº†1000çš„æ•°é‡ï¼Œæœ€åè¶…å‡ºçš„é”®å€¼å¯¹å°±ç›´æ¥åœ¨parseçš„è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ã€‚


## æ€è€ƒ&å‘ç°

æŒ‰å®˜æ–¹çš„è¯´æ˜ï¼Œå½“QSç”¨äºè§£æç”¨æˆ·è¾“å…¥æ—¶ï¼Œæ·±åº¦é™åˆ¶æœ‰åŠ©äºå‡å°‘æ»¥ç”¨ï¼Œå»ºè®®å°†å…¶ä¿æŒåœ¨é€‚åˆçš„è¾ƒå°æ•°é‡ï¼Œå¯¹äºå‚æ•°é™åˆ¶ä¹Ÿæ˜¯ç›¸ä¼¼çš„åŸå› ã€‚

å®é™…æ“ä½œä¸­ï¼Œå¾ˆå°‘ä¼šæœ‰è¡¨å•ç±»å‹çš„æ•°æ®å¤§äº1000é”®å€¼å¯¹çš„æƒ…å†µã€‚è€Œæœ¬æ¬¡æŸ¥å‡ºçš„è¿™ä¸ªé—®é¢˜ï¼Œæ°å¥½ä¹Ÿååº”äº†koa-graceä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶éšåè¿›è¡Œäº†ä¿®æ­£ï¼šåœ¨åˆ¤æ–­`Content-Type`æ—¶ï¼Œä¼˜å…ˆåˆ¤æ–­æ˜¯å¦JSONæ ¼å¼`application/json`ï¼ˆæ­¤å‰é»˜è®¤å…ˆåˆ¤æ–­`application/x-www-form-urlencoded`ï¼‰ã€‚


æŸ¥æ‰¾é—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿå‘ç°äº†å…¶ä»–æ¡†æ¶åŒæ ·å­˜åœ¨è¿™ç§å¤„ç†ã€‚æ¯”å¦‚åœ¨[Express.js][url_express]çš„å®˜æ–¹ç»„ä»¶[expressjs/body-parser][url_bodyparser]çš„æ–‡æ¡£ä¸­ï¼Œå‘ç°äº†ä»¥ä¸‹æè¿°ï¼š

> The parameterLimit option controls the maximum number of parameters that are allowed in the URL-encoded data. If a request contains more parameters than this value, a 413 will be returned to the client. **Defaults to 1000.**

è¿™æ ·çš„å¤„ç†(413)ï¼Œè‡³å°‘è¿˜æœ‰è¿¹å¯å¾ªï¼Œåƒä¸Šé¢é‚£æ ·éè¦åˆ°æºç é‡Œç¡®è®¤çš„æƒ…å†µï¼ŒçœŸæ˜¯å‘äº†ğŸ˜‚


## å¹´ç»ˆåæ§½

æ—¶å€¼å¹´å‰æœ€åä¸€å¤©ä¸Šç­ï¼Œæ˜å¤©å°±é£ä¸‰äºšå¼€å¹´ä¼šå»äº†ï¼Œå±…ç„¶è¿˜åŠ ç­åˆ°å…¬å¸æ²¡äººæ‰èµ°ï¼Œä¹Ÿæ˜¯é†‰äº†...



[url_qs/parser.js]: https://github.com/ljharb/qs/blob/v4.0.0/lib/parse.js#L22
[url_qs]: https://github.com/ljharb/qs
[url_express]: https://github.com/expressjs
[url_bodyparser]: https://github.com/expressjs/body-parser




